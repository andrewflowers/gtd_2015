{
    "collab_server" : "",
    "contents" : "# 2015 update to GTD\n\nsetwd(\"~/stories/gtd_2015/\")\n\nrequire(dplyr)\nrequire(readr)\nrequire(tidyr)\nrequire(ggplot2)\nrequire(stringr)\nrequire(lubridate)\n\n# Load 2012-2015 data\nraw_new_data <- read.csv(\"Global Terrorism Database 2012-2015 EMBARGOED.csv\", stringsAsFactors = FALSE)\n\n# Load 1970-2014 data (except for 1993)\nraw_old_data <- data.frame()\n\nfor (f in list.files(\"./raw-data/\")){\n  data <- read_csv(paste0(getwd(), \"/raw-data/\", f))\n  raw_old_data <- rbind(raw_old_data, data)\n}\n\n# Complete time series, 1970-2014\nraw_old_data %>% \n  rename(year = iyear) %>% \n  group_by(year) %>% \n  summarize(attacks = n(),\n            fatalities = sum(nkill, na.rm = TRUE)) %>% \n  gather(type, num, 2:3) %>% \n  ggplot(aes(x = year, y = num, group = type, color = type)) + \n  geom_line() + \n  ggtitle (\"Terrorism Attacks and Fatalities, 1970-2014\n           Note: data from 2012-2014 used different collection techniques\")\n\n# Latest data, 2012-2014\nnew_data <- raw_new_data %>%\n  # filter(country_txt == \"United States\") %>% \n  rename(year = iyear) %>% \n  group_by(year) %>% \n  summarize(attacks = n()/1000,\n            fatalities = sum(nkill, na.rm = TRUE)/1000) \n\nnew_data %>% write_csv(\"new_total_attacks_fatalities.csv\")\n\nnew_data %>% \n  gather(type, num, 2:3) %>% \n  ggplot(aes(x = year, y = num, fill=type, group=type)) + \n  geom_bar(stat = \"identity\", position = \"dodge\") + \n  ggtitle (\"Terrorism Attack and Fatalities, 2012-2014, in thousands\")\n\n# Incidents by region\ndata_by_region <- raw_new_data %>% \n  group_by(iyear, region_txt) %>% \n  summarize(attacks = n()/1000,\n            fatalities = sum(nkill, na.rm = TRUE)/1000) %>% \n  filter(region_txt %in% c(\"Middle East & North Africa\", \"South Asia\",\n                           \"Sub-Saharan Africa\", \"Western Europe\",\n                           \"Eastern Europe\", \"North America\")) \n\ndata_by_region %>% select(-fatalities) %>% \n  spread(region_txt, attacks) %>% write_csv(\"attacks_by_region.csv\")\n\ndata_by_region %>%\n  ggplot(aes(x = iyear, y = fatalities, color = region_txt, group = region_txt)) +\n  geom_line() +\n  ggtitle(\"Terrorism attacks by region, 2012-2015\")\n\n# Most lethal attacks\nlethal_attacks <- raw_new_data %>% \n  filter(iyear == 2015) %>% \n  arrange(desc(nkill)) %>% \n  select(iyear, imonth, iday, country_txt, city, nkill, nwound,\n         targtype1_txt, gname, summary)\n\n# Attacks table\nattacks_table <- lethal_attacks %>% \n  mutate(date = ymd(str_c(iyear, imonth, iday, sep = \"-\")),\n         location = str_c(city, country_txt, sep = \", \")) %>% \n  select(date, location, gname, nkill) %>% \n  rename(Date = date, Location = location, `Number killed` = nkill, `Group responsible` = gname) %>% \n  head(25)\n\nattacks_table %>% write_csv(\"worst_attacks_table.csv\")\n\n# Most lethal attacks in North America or Western Europe\nlethal_attacks_west <- raw_new_data %>% \n  filter(iyear == 2015, region_txt %in% c(\"Western Europe\", \"North America\")) %>% \n  arrange(desc(nkill)) %>% \n  select(iyear, imonth, iday, country_txt, city, nkill, nwound,\n         targtype1_txt, gname, summary)\n\n# US attacks\nus_attacks <- lethal_attacks %>% \n  filter(iyear == 2015, country_txt == \"United States\") %>% \n  mutate(date = ymd(str_c(iyear, imonth, iday, sep = \"-\"))) %>% \n  select(date, city, gname, nkill, summary) %>% \n  rename(Date = date, City = city, `Number killed` = nkill, `Group responsible` = gname)\n\n# Country breakdown\ndata_by_country <- raw_new_data %>% \n  group_by(iyear, country_txt) %>% \n  summarize(attacks = n(), \n            fatalities = sum(nkill, na.rm = TRUE)) %>% \n  ungroup() %>% \n  arrange(desc(attacks)) %>% \n  filter(iyear == 2015)\n\n# Worst groups\nterror_by_groups <- raw_new_data %>% \n  filter(iyear == 2015) %>% \n  group_by(gname) %>% \n  summarize(attacks = n(),\n            fatalities = sum(nkill, na.rm = TRUE)) %>% \n  ungroup() %>% \n  arrange(desc(attacks))\n\nterror_by_groups %>% select(-attacks) %>% \n  head(11) %>% write_csv(\"deadliest_terror_groups.csv\")\n\n# Lone wolf attacks\nlone_wolf <- raw_new_data %>% \n  filter(gname == \"Unaffiliated Individual(s)\" |\n           gname == \"Individual(s)\") %>% \n  group_by(iyear, gname) %>% \n  summarize(attacks = n(),\n            fatalities = sum(nkill, na.rm = TRUE))\n\n# By attack types\nraw_new_data %>% \n  group_by(iyear, attacktype1_txt) %>% \n  summarize(incidents = n()) %>% \n  spread(attacktype1_txt, incidents)\n\n# By country\nraw_new_data %>% \n  group_by(iyear, country_txt) %>% \n  summarize(incidents = n()) %>% \n  arrange(desc(incidents)) %>% \n  filter(incidents >= 38) %>% \n  ggplot(aes(x = iyear, y = incidents, group = country_txt, color = country_txt)) + \n  geom_line()\n\n# Weapon type\nraw_new_data %>% \n  group_by(iyear, weaptype1_txt) %>% \n  summarize(incidents = n()) %>% \n  spread(iyear, incidents)\n\n# Target type\ntarget_type <- raw_new_data %>% \n  group_by(iyear, targtype1_txt) %>% \n  summarize(incidents = n()) %>% \n  spread(iyear, incidents)",
    "created" : 1466454529457.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "17569403",
    "id" : "FFB6C2F9",
    "lastKnownWriteTime" : 1467098101,
    "last_content_update" : 1467098101292,
    "path" : "~/stories/gtd_2015/gtd_2015.R",
    "project_path" : "gtd_2015.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}